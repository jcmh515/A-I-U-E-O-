<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <title>äº”åéŸ³ åå°„ç¥ç¶“è¨“ç·´å™¨ (çµ‚æ¥µç‰ˆ)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; padding: 50px; background-color: #f4f7f6; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* æ§åˆ¶é¢æ¿æ’ç‰ˆ */
        .controls { margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 10px; }
        .checkbox-group { margin-bottom: 15px; font-size: 18px; font-weight: bold; color: #34495e; }
        .checkbox-group label { margin-right: 20px; cursor: pointer; }
        .checkbox-group input { transform: scale(1.3); margin-right: 5px; cursor: pointer; }
        
        select, button { font-size: 18px; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 8px; border: none; font-weight: bold; transition: 0.2s; }
        select { border: 1px solid #ccc; background: white; }
        
        #start-btn { background-color: #4CAF50; color: white; box-shadow: 0 4px #388E3C; }
        #start-btn:active { transform: translateY(4px); box-shadow: 0 0 #388E3C; }
        #start-btn.running { background-color: #f44336; box-shadow: 0 4px #d32f2f; }
        
        #speaker-btn { background-color: #2196F3; color: white; box-shadow: 0 4px #1976D2; }
        #speaker-btn:disabled { background-color: #cccccc; color: #666; box-shadow: none; cursor: not-allowed; }
        
        #timer-display { font-size: 28px; color: #e67e22; margin-top: 15px; font-weight: bold; }

        /* é¡¯ç¤ºå€æ’ç‰ˆï¼šç”¨ Flexbox ä»¤å­—é«”åŒæ‹¼éŸ³å°é½Š */
        #display-area { 
            display: flex; 
            justify-content: center; 
            flex-wrap: wrap; 
            gap: 20px; 
            margin: 40px 0; 
            min-height: 120px; 
        }
        .kana-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .kana {
            font-size: 60px;
            font-weight: bold;
            color: #2c3e50;
        }
        .romaji {
            font-size: 24px;
            color: #e74c3c;
            font-weight: bold;
            margin-top: 5px;
        }
        /* éš±è—ç¾…é¦¬éŸ³ï¼Œä½†ä¿ç•™ç©ºé–“ï¼Œç­‰å•²å­—å””æœƒè·³ä½ */
        .hidden {
            visibility: hidden; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ¯ äº”åéŸ³ åå°„ç¥ç¶“è¨“ç·´å™¨</h2>
        
        <div class="controls">
            <div class="checkbox-group">
                <span>é¸æ“‡æº«ç¿’ç¯„åœ (å¯å¤šé¸)ï¼š</span><br><br>
                <input type="checkbox" id="row-a" value="a" checked> 
                <label for="row-a">ã‚è¡Œ (a i u e o)</label>
                
                <input type="checkbox" id="row-k" value="k"> 
                <label for="row-k">ã‹è¡Œ (ka ki ku ke ko)</label>
            </div>

            <label for="char-count">é¸æ“‡æŠ½è€ƒå­—æ•¸ï¼š</label>
            <select id="char-count">
                <option value="3">3 å€‹éŸ³</option>
                <option value="5" selected>5 å€‹éŸ³</option>
                <option value="7">7 å€‹éŸ³</option>
                <option value="10">10 å€‹éŸ³ (åœ°ç„ç´š)</option>
                <option value="15">15 å€‹éŸ³ (ç¥ç´š)</option>
            </select>
        </div>
        
        <div id="display-area">
            <div style="font-size: 30px; color: #95a5a6; margin-top: 30px;">è«‹æ’³ã€Œé–‹å§‹æ¸¬è©¦ã€</div>
        </div>
        
        <button id="start-btn">â–¶ï¸ é–‹å§‹æ¸¬è©¦</button>
        <button id="speaker-btn" disabled>ğŸ”Š è½ Google æ­£ç¢ºç™¼éŸ³</button>
        
        <div id="timer-display">æ™‚é–“: 0.00 ç§’</div>
    </div>

    <script>
        // è¨­å®šå­—å…¸ï¼šåŒ…å«æ—¥æ–‡åŒå°æ‡‰å˜…ç¾…é¦¬éŸ³
        const kanaMap = {
            'a': [
                {kana: 'ã‚', romaji: 'a'}, {kana: 'ã„', romaji: 'i'}, 
                {kana: 'ã†', romaji: 'u'}, {kana: 'ãˆ', romaji: 'e'}, {kana: 'ãŠ', romaji: 'o'}
            ],
            'k': [
                {kana: 'ã‹', romaji: 'ka'}, {kana: 'ã', romaji: 'ki'}, 
                {kana: 'ã', romaji: 'ku'}, {kana: 'ã‘', romaji: 'ke'}, {kana: 'ã“', romaji: 'ko'}
            ]
        };

        let isRunning = false;
        let startTime;
        let timerInterval;
        let currentRawText = ''; // ç”¨åšŸç•€ Google è®€éŸ³

        const displayArea = document.getElementById('display-area');
        const startBtn = document.getElementById('start-btn');
        const speakerBtn = document.getElementById('speaker-btn');
        const timerDisplay = document.getElementById('timer-display');
        const charCountSelect = document.getElementById('char-count');

        // æ ¹æ“šç”¨å®¶å‰”é¸å˜… Checkboxï¼Œå°‡å­—åº«æºåŸ‹ä¸€é½Š
        function getSelectedPool() {
            let pool = [];
            if (document.getElementById('row-a').checked) pool = pool.concat(kanaMap['a']);
            if (document.getElementById('row-k').checked) pool = pool.concat(kanaMap['k']);
            
            // å¦‚æœç”¨å®¶å’©éƒ½ç„¡å‰”ï¼Œé è¨­ç•€è¿”ã€Œã‚è¡Œã€ä½¢
            if (pool.length === 0) {
                document.getElementById('row-a').checked = true;
                pool = kanaMap['a'];
            }
            return pool;
        }

        // ç”Ÿæˆç•«é¢ï¼šæ—¥æ–‡å–ºä¸Šé¢ï¼Œç¾…é¦¬éŸ³å–ºä¸‹é¢ (é è¨­éš±è—)
        function generateDisplay(length) {
            const pool = getSelectedPool();
            let html = '';
            currentRawText = ''; 
            
            for (let i = 0; i < length; i++) {
                const randomObj = pool[Math.floor(Math.random() * pool.length)];
                currentRawText += randomObj.kana;
                
                // æ¯å€‹å­—åŒ…å–ºä¸€å€‹æ ¼ä»”å…¥é¢ï¼Œromaji é è¨­åŠ å’— 'hidden' class
                html += `
                    <div class="kana-box">
                        <div class="kana">${randomObj.kana}</div>
                        <div class="romaji hidden">${randomObj.romaji}</div>
                    </div>
                `;
            }
            displayArea.innerHTML = html;
        }

        function updateTimer() {
            const currentTime = new Date().getTime();
            const elapsedTime = (currentTime - startTime) / 1000;
            timerDisplay.textContent = `æ™‚é–“: ${elapsedTime.toFixed(2)} ç§’`;
        }

        startBtn.addEventListener('click', () => {
            if (!isRunning) {
                // æŒ‰ä¸‹é–‹å§‹
                isRunning = true;
                startBtn.textContent = 'â¹ï¸ è®€å®Œï¼(åœæ­¢è¨ˆæ™‚)';
                startBtn.classList.add('running');
                speakerBtn.disabled = true; 
                timerDisplay.style.color = '#333';
                
                const length = parseInt(charCountSelect.value);
                generateDisplay(length); // ç”Ÿæˆé¡Œç›®
                
                startTime = new Date().getTime();
                timerInterval = setInterval(updateTimer, 50); 
            } else {
                // æŒ‰ä¸‹åœæ­¢
                isRunning = false;
                clearInterval(timerInterval);
                startBtn.textContent = 'ğŸ”„ å†åšŸä¸€æ¬¡ (é–‹å§‹)';
                startBtn.classList.remove('running');
                speakerBtn.disabled = false; 
                timerDisplay.style.color = '#e67e22'; 
                
                // ç¥å¥‡é­”æ³•ï¼šå°‡æ‰€æœ‰ç¾…é¦¬éŸ³é¡¯ç¤ºå‡ºåšŸï¼
                const romajiElements = document.querySelectorAll('.romaji');
                romajiElements.forEach(el => el.classList.remove('hidden'));
            }
        });

        speakerBtn.addEventListener('click', () => {
            if (currentRawText) {
                // æ¯å€‹å­—ä¸­é–“åŠ é€—è™Ÿï¼Œç­‰ä½¢é€å€‹éŸ³è®€
                const spacedText = currentRawText.split('').join(', ');
                const utterance = new SpeechSynthesisUtterance(spacedText);
                utterance.lang = 'ja-JP'; 
                utterance.rate = 0.75; 
                window.speechSynthesis.speak(utterance);
            }
        });
    </script>
</body>
</html>
